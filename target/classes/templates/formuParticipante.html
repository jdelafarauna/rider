<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formulario de Datos de Competición</title>
    <link rel="stylesheet" type="text/css" href="/css/EFormuParticipante.css">
    <link rel="stylesheet" type="text/css" href="/css/ECabecera.css">

</head>
<body>

    <nav class="navbar">
        <img src="../../Imagenes/logoC.png" alt="logo">
        <div class="containerCabecera">
            
            <ul class="nav-links">
                <li><a href="indice">Inicio</a></li>
                <li><a href="calendario">Calendario</a></li>
                <li><a href="formuReserva">Reservas</a></li>
                <li><a href="concursos">Concursos</a></li>
                <li><a href="Contacto">Contacto</a></li>
            </ul>
        </div>
    </nav>

    <div class="container">
        <div class="espacio">
            <h2>Participante</h2>
            <form id="ParticipanteForm" method="post">
                <label for="nombre">Nombre del Competidor:</label><br>
                <input type="text" id="nombre" name="nombre" required><br><br>
        
                <label for="caballo">Nombre del Caballo:</label><br>
                <input type="text" id="caballo" name="caballo" required><br><br>
        
                <label for="derribos">Número de Derribos:</label><br>
                <input type="number" id="derribos" name="derribos" required><br><br>
        
                <label for="desobediencias">Número de Desobediencias:</label><br>
                <input type="number" id="desobediencias" name="desobediencias" required><br><br>
                
                <label for="eliminado">Eliminado:</label>
                <input type="checkbox" id="eliminado" name="eliminado">
        
                <label style="margin-right: 40px;"></label>
        
                <label for="caido">Caido:</label>
                <input type="checkbox" id="caido" name="caido"><br><br>
        
                <label for="tiempo">Tiempo (en segundos):</label><br>
                <input type="number" id="tiempo" name="tiempo" step="0.01" required><br><br>
        
                <label for="observaciones">Observaciones:</label><br>
                <textarea id="observaciones" name="observaciones" rows="4" cols="50"></textarea><br><br>
        
                <input type="submit" value="Enviar">
            </form>
        </div>
    
        <div class="espacio" id="cronometro-container">
            <div class="container">
                <div class="col" id="cronometro">00:00</div>
                <div class="col">
                    <button onclick="iniciarCronometro()">&#9654;</button>
                    <button onclick="pausarCronometro()">&#9208;</button>
                    <button onclick="reiniciarCronometro()">&#8635;</button>
                </div>
            </div>
        </div>
        <script src="../static/cronometro.js"></script>
    </div>
    
    

    {{>clasificacion}}

    <br><br><br><br><br><br><br><br>

    <script>

        var url = window.location.href;
        console.log(url);
        var urlObj = new URL(url);
        var id = urlObj.searchParams.get("id");
        console.log(id);
        const urlP = `https://riderrank.onrender.com/apiCompetidor/posts`;

        document.getElementById('ParticipanteForm').addEventListener('submit', function(event) {
            event.preventDefault(); // Evita que el formulario se envíe por defecto
            
            // Obtiene los valores de los campos del formulario
            var nombre = document.getElementById('nombre').value;
            var caballo = document.getElementById('caballo').value;
            var derribos = parseInt(document.getElementById('derribos').value);
            var desobediencias = parseInt(document.getElementById('desobediencias').value);
            var eliminado = document.getElementById('eliminado').checked;
            var caido = document.getElementById('caido').checked;
            var tiempo = parseFloat(document.getElementById('tiempo').value);
            var observaciones = document.getElementById('observaciones').value;
            var idConcurso = id;
            //var puntos = parseInt(document.getElementById('puntos').value);
            
            // Crea el objeto 'data' con los valores obtenidos del formulario
            const data = {
                nombre: nombre,
                caballo: caballo,
                derribos: derribos,
                desobediencias: desobediencias,
                eliminado: eliminado,
                caido: caido,
                tiempo: tiempo,
                observaciones: observaciones,
                idConcurso: idConcurso
                //puntos: puntos
            };
            
            // Enviar los datos a través de AJAX
            fetch(urlP, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(data),
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Error en la solicitud');
                }
                return response.json();
            })
            .then(data => {
                console.log('Nuevo post creado:', data);
                // Puedes redirigir a otra página o realizar cualquier otra acción aquí
            })
            .catch(error => {
                console.error('Error:', error);
            });
            
            // Limpiar los campos del formulario si es necesario
            document.getElementById('nombre').value = '';
            document.getElementById('caballo').value = '';
            document.getElementById('derribos').value = '';
            document.getElementById('desobediencias').value = '';
            document.getElementById('eliminado').checked = false;
            document.getElementById('caido').checked = false;
            document.getElementById('tiempo').value = '';
            document.getElementById('observaciones').value = '';
            document.getElementById('puntos').value = '';
        });
    </script>
</body>
</html>
